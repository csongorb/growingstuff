"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),_Barkeep=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e);this.default_args={container_sel:"h-bartender",pint_bar_class:"h-pint",pint_pos_class:"m-pint-pos",pint_wrap_class:"m-pint-wrap",fixed_class:"is-fixed",inactive_class:"is-dead",bar_type:"static",front_door:"h-front",back_door:"h-back",do_remove_sel:"h-do-remove-pint",drop_shadows:!1,init:function(e){},on_bar_down:function(e){}},this.args=Object.assign({},this.default_args,i),this.suppressed=!1,this.initiated=!1,this.organic_height=0,this.fixed_height=0,this.bars=[],this._container=document.querySelector("."+this.args.container_sel),this._container||this.setupContainer(),this.doPushQueue(),this.setup(),window.addEventListener("scroll",this.check_fixed.bind(this));var o=!1;window.addEventListener("resize",function(){o||(t.setup(),setTimeout(function(){o=!1,clearTimeout()},200),o=!0)}),"function"==typeof this.args.init&&this.args.init(this),this.initiated=!0}return _createClass(e,[{key:"doPushQueue",value:function(){window.BKQ=function(e){if(e&&e.length)for(var t=0;t<e.length;t++)"function"==typeof e[t]&&e[t]();return{push:function(e){"function"==typeof e&&e()}}}(window.BKQ)}},{key:"get_organic_height",value:function(){return this.organic_height}},{key:"get_fixed_height",value:function(){return this.fixed_height}},{key:"setupContainer",value:function(){var e=this.args,t=e.container_sel,i=e.pint_bar_class,o=void 0,n=void 0,r=void 0;o=document.createElement("div"),o.className=t,n=document.querySelector("."+i),n?(n.parentNode.insertBefore(o,n),r=document.querySelectorAll("."+i),r=[].slice.call(r),r.forEach(function(e){o.appendChild(e)})):document.body.insertBefore(o,document.body.firstChild),this._container=o}},{key:"setup",value:function(){var e=this;this.bars=[],this.fixed_height=0,this.organic_height=0;var t=this._container,i=this.args,o=i.bar_type,n=i.pint_bar_class,r=i.pint_wrap_class,s=i.pint_pos_class,a=i.do_remove_sel,d=i.inactive_class,l=(i.fixed_class,void 0),c=void 0;l=t.querySelectorAll("."+n)||[],l=[].slice.call(l),l.forEach(function(t){var i=t.parentNode,o=i.parentNode,n=void 0,d=void 0,l=void 0;i.classList.contains(s)&&o.classList.contains(r)||(i=document.createElement("div"),o=document.createElement("div"),i.className=s,o.className=r,t.parentNode.insertBefore(i,t),i.appendChild(t),n=t.parentNode,n.parentNode.insertBefore(o,n),o.appendChild(n),d=n.parentNode,l=n.querySelectorAll("."+a)||[],l=[].slice.call(l),l.forEach(function(t){t.addEventListener("click",function(){e.remove(d)})}))}),c=t.querySelectorAll("."+r)||[],c=[].slice.call(c),c.forEach(function(t){var i=t.querySelector("."+s),r=t.querySelector("."+n),a=void 0,l=void 0,c=void 0,p=void 0;return r?(t.classList.contains(d)&&t.classList.remove(d),"none"===r.style.display||"none"===getComputedStyle(r).display?void t.classList.add(d):(p=t.getAttribute("data-pint-id"),p||(p=Math.random().toString(36).substr(2,12),t.setAttribute("data-pint-id",p)),a=r.getAttribute("data-type")||o,a&&t.setAttribute("data-type",a),c=r.style.height||r.offsetHeight+"px",i.style.width="100%",i.style.zIndex="5",l={pint_id:p,type:a,fixed:!1,height:c,top:t.getBoundingClientRect().top+document.body.scrollTop,fixed_top:0,_bar:r,_pos:i,_wrap:t,priority:r.getAttribute("data-priority")||2},"fixed"===l.type&&(l.fixed_top=e.fixed_height,l._pos.style.height=l.height,l._pos.style.top=l.fixed_top+"px",e.fixed_height+=parseInt(l.height)),e.organic_height+=parseInt(l.height),e.bars.push(l),void e.pick_up_or_put_down(l))):void t.parentNode.removeChild(t)})}},{key:"insert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=void 0,s=this._container,a=this.suppressed,d=this.args,l=d.front_door,c=d.back_door,p=s.querySelector("."+l),h=s.querySelector("."+c);return p||(p=document.createElement("div"),p.className=l,s.insertBefore(p,s.firstChild)),h||(h=document.createElement("div"),h.className=c,s.appendChild(h)),a&&o&&!n?(console.log("Bartender: Suppresed pint insert"),!1):("string"==typeof e?(r=document.createElement("div"),r.innerHTML=e,r=r.firstChild):"object"===(void 0===e?"undefined":_typeof(e))&&(r=e.length?e[0]:e),!r||r.getAttribute("data-priority")||o||r.setAttribute("data-priority",2),i?"top"===t?s.insertBefore(r,s.firstChild):s.appendChild(r):"top"===t?s.insertBefore(r,p):s.insertBefore(r,h),this.setup(),!0)}},{key:"pick_up_or_put_down",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.args,i=t.on_bar_down,o=t.fixed_class,n=t.drop_shadows;e._pos.querySelector(".inner");return"static"!==e.type&&(window.scrollY+e.fixed_top>e.top?(n&&(e._pos.style.boxShadow="0px 3px 10px rgba(0, 0, 0, 0.4)"),e._wrap.classList.add(o),e._pos.style.position="fixed",e.fixed=!0):(n&&(e._pos.style.boxShadow="0px 3px 10px rgba(0, 0, 0, 0.4)"),e._pos.style.position="static",e._wrap.classList.remove(o),e.fixed=!1,"function"==typeof i&&i(e)),!0)}},{key:"check_fixed",value:function(){var e=this;return(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||window.scrollY<=this.organic_height+80)&&this.bars.forEach(function(t){e.pick_up_or_put_down(t)}),!0}},{key:"remove",value:function(e){if(!e)return!1;for(var t=e.getAttribute("data-pint-id"),i=void 0,o=void 0,n=void 0,r=this.bars.length;r--;)if(this.bars[r].pint_id===t){i=r;break}return void 0!==i&&(o=this.bars[i],o._wrap.parentNode.removeChild(o._wrap),"fixed"===o.type&&o.fixed&&(n=parseInt(o.height),window.scrollTo(window.scrollX,window.scrollY-n)),this.setup(),!0)}},{key:"remove_expendables",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1;return t&&(this.suppressed=!0),this.bars.forEach(function(t){t._bar.getAttribute("data-priority")||t.priority;if(t.priority>=e&&(console.log("Removed: "+t._bar.className),t._wrap.parentNode.removeChild(t._wrap),i=!0,"fixed"===t.type)){var o=parseInt(t.height);window.scrollTo(window.scrollX,window.scrollY-o)}}),this.setup(),i}}]),e}();"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=_Barkeep);